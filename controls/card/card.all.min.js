"use strict";angular.module("formarble/controls/card",["formarble"]).directive("fmCardNumber",["fm",function(e){return{templateUrl:e.urlResolver("card-number")}}]).directive("fmCardNumberInput",["$browser",function(e){function t(e,t,r,n,o){for(n=+e[t=e.length-1],o=0;t--;)r=+e[t],n+=++o%2?2*r%10+(r>4):r;return!(n%10)}function r(e){if(e.selectionStart)return e.selectionStart;if(document.selection){e.focus();var t=document.selection.createRange();if(null==t)return 0;var r=e.createTextRange(),n=r.duplicate();return r.moveToBookmark(t.getBookmark()),n.setEndPoint("EndToStart",r),n.text.length}return 0}function n(e,t){if(e.createTextRange){var r=e.createTextRange();r.move("character",t),r.select()}else e.selectionStart?(e.focus(),e.setSelectionRange(t,t)):e.focus()}function o(e){return e?e.replace(/[^\d]+/g,""):e}function c(e){var t;if(!e)return e;switch(e=o(e),t=l(e)){case"visa":case"mastercard":default:e=e.slice(0,16).replace(/(\d{4})/g,"$1 ");break;case"amex":e=e.slice(0,15).replace(/^(\d{4})(\d{6})(\d+)/,"$1 $2 $3").replace(/^(\d{4})(\d+)/,"$1 $2")}return e.trim()}function l(e){return e?"4"===e[0]?"visa":-1!==["34","37"].indexOf(e.slice(0,2))?"amex":-1!==["51","52","53","54","55"].indexOf(e.slice(0,2))?"mastercard":void 0:void 0}return{require:"ngModel",link:function(l,a,i,s){function u(){var e,t,o=a.val(),l=r(a[0]);s.$isEmpty(o)||(t=o.slice(0,l),l-=t.length-c(t).length,e=c(o),e!=o&&(a.val(e),n(a[0],l)))}a.bind("keyup",function(){var t=event.keyCode;91==t||t>15&&19>t||t>=37&&40>=t||e.defer(u)}),a.bind("change paste cut",function(){e.defer(u)}),s.$formatters.push(function(e){return e?c(e):void 0}),s.$parsers.unshift(function(e){return e?o(c(e)):void 0}),s.$parsers.push(function(e){return s.$error.required?void s.$setValidity("creditCard",!0):!s.$isEmpty(e)&&t(e)?(s.$setValidity("creditCard",!0),e):void s.$setValidity("creditCard",!1)})}}}]).directive("fmCardExpiry",["fm",function(e){function t(e,t,r){var n,o=[];for(t+=r?1:0,n=e;t>n;n++)o.push(n);return o}function r(t,r,n){t.$watch(r,function(r){e.oset(t,n,r)}),t.$watch(n,function(n){e.oset(t,r,n)})}var n=new Date;return{templateUrl:e.urlResolver("card-expiry"),controller:["$scope","$element",function(e){var o="year",c="month",l=["$model",e.$control.properties.year._path].join("."),a=["$model",e.$control.properties.month._path].join("."),i=n.getFullYear(),s=i+10,u=n.getMonth()+1,d=t(u,12,!0),m=t(1,12,!0);e._years=t(i,s,!0),e.$watch(o,function(t){t===i?(e._months=d,e.month<u&&(e.month=u)):e._months=m}),r(e,l,o),r(e,a,c)}]}}]),angular.module("formarble/controls/card").run(["$templateCache",function(e){e.put("bs-common/card-expiry.html",'<div class="form-group"><label class="control-label col-sm-4" fm-control-label="" for=""></label><div class="col-sm-4"><div class="row"><div class="col-xs-6"><select class="form-control" ng-model="year" ng-options="y for y in _years"></select></div><div class="col-xs-6"><select class="form-control" ng-model="month" ng-options="m for m in _months"></select></div></div><p class="help-block" ng-if="$control.description">{{$control.description}}</p></div></div>')}]),angular.module("formarble/controls/card").run(["$templateCache",function(e){e.put("bs-common/card-number.html",'<div class="form-group" ng-class="{\'has-error\': $input.$dirty && $input.$invalid}"><label class="control-label col-sm-4" fm-control-label=""></label><div class="col-sm-8"><input class="form-control" type="text" fm-control-input="" fm-card-number-input=""><input class="form-control" type="text" fm-control-input="">{{$caret}}<p ng-if="$control.description" class="help-block">{{$control.description}}</p></div></div>')}]);