"use strict";angular.module("formarble/controls/tree",["formarble"]).directive("fmTree",["fm",function(e){return{templateUrl:e.urlResolver("tree"),scope:!0,controllerAs:"$tree",controller:["$scope","$element","$attrs",function(t,r,i){function l(e){var t=e,r=[];do t.treeItems=s.items(t),r.push(t),t=t.$parent;while(t);return r.reverse()}var n,s=this,o=t.$eval(i.fmTree||"$control");t.$isSubtree=angular.isDefined(r.parent().controller("fmTree")),t.$subControls=t.$subControls.filter(function(e){return n||(n=e),-1===o.display.tree.indexOf(e._id)}),this.select=function(e){this.selected=e,this.breadcrumb=l(e)},this.isSelected=function(e){return e===this.selected},this.isOpen=function(t){var r=e.oget(t,"display.open");return r=r||this.selected&&this.selected.path.slice(0,t.path.length)===t.path},this.items=function(t){return(e.oget(t,"display.tree")||[]).map(function(e){return t.properties[e]}).filter(angular.identity)},this.selected=null,!n||t.$isSubtree||t.$subControls.length||this.select(n)}]}}]).directive("fmTreeOverview",["$compile","$templateCache",function(e,t){return{require:["^fmTree","^fmForm"],scope:!0,link:function(r,i,l,n){var s=n[0],o=n[1],c=void 0===l.fmTreeBreadcrumb?"tree-sidebar":"tree-breadcrumb",a=r.$eval(l.fmTreeOverview);a.display.tree&&(r.$items=s.items(a),r.$selected=r.$items[0],i.html(t.get(o.getTemplateUrl(c))),e(i.contents())(r)),r.$select=function(e){r.$selected=e,s.select(e)}}}}]),angular.module("formarble/controls/tree").run(["$templateCache",function(e){e.put("bs/tree-breadcrumb.html",'<div class="hidden-lg btn-toolbar"><div class="btn-group btn-group-sm" ng-repeat-start="i in $tree.breadcrumb track by i.path" ng-if="i.treeItems.length"><button class="btn btn-default" ng-click="$select(i)" ng-class="{\'btn-primary\': $tree.isSelected(i)}">{{i.title}}</button> <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button><ul class="dropdown-menu"><li ng-repeat="i in i.treeItems"><a href="" ng-click="$select(i)">{{i.title}}</a></li></ul></div><div class="btn-group btn-group-sm" ng-repeat-end="" ng-if="!i.treeItems.length"><button type="button" class="btn btn-primary active">{{i.title}}</button></div></div>')}]),angular.module("formarble/controls/tree").run(["$templateCache",function(e){e.put("bs/tree-sidebar.html",'<li ng-repeat="i in $items" ng-class="{selected: $tree.isSelected(i), open: $tree.isOpen(i)}"><a href="" ng-click="$select(i)">{{i.title}}</a><ul ng-if="$tree.isOpen(i)" fm-tree-overview="i"></ul></li>')}]),angular.module("formarble/controls/tree").run(["$templateCache",function(e){e.put("bs/tree.html",'<h3 class="text-muted" ng-if="!$isSubtree"><a href="" ng-click="$tree.select()">{{$control.title}}</a></h3><div class="row"><div class="col-lg-3" ng-if="!$isSubtree"><div class="visible-lg hidden-sm" fm-tree-overview="$control"></div><div class="hidden-lg" fm-tree-overview="$control" fm-tree-breadcrumb=""></div></div><div ng-class=" {\'col-lg-12\': $isSubtree, \'col-lg-9\': !$isSubtree}"><div ng-if="!$tree.selected && $subControls.length"><div ng-repeat="c in $subControls" fm-control="c"></div></div><div ng-if="!$tree.selected && !$subControls.length"><h3 class="text-muted">Select option in tree</h3></div><div ng-if="$tree.selected"><div fm-control="$tree.selected"></div></div></div></div>')}]);